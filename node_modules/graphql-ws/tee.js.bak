var DuplexBufferStream = require('duplexbufferstream');
var fs = require('fs');

tee = fs.createReadStream('/home/ykiruha/Downloads/X-Men.Apocalypse.2016.x264.BDRip.(1080p).ExKinoRay.mkv');

//var tee = new DuplexBufferStream();
//process.stdin.pipe(tee);

//tee.on('readable', ()=>console.log('readable'))
//tee.on('error', ()=>console.log('error'))
//tee.on('end', ()=>console.log('end'))

function readall() {
	tee.on('readable', () => {
			var chunk;
			let read = 0;
			for (i = 0; i < 100000000; i++) chunk = i;
					while((chunk = tee.read(2 * 1024 * 1024)) !== null) {
						read += chunk.length;
					}
	//		console.log(read);
	//				setTimeout(() => readall(), 100);
			});
}

readall();

setInterval(()=>{console.log(process.memoryUsage());}, 1000);
