var fs = require('fs');

//tee = fs.createReadStream('/home/ykiruha/Downloads/X-Men.Apocalypse.2016.x264.BDRip.(1080p).ExKinoRay.mkv');
tee = fs.createReadStream('/tmp/example.txt');

const { Writable } = require('stream');

let buf = new Buffer(30 * 1024 * 1024); // 2KB
let bufOffset = 0;
const writable = Writable({
  final() { console.log('FINAL'); },
  destroy() { console.log('DESTROY'); },
  write(chunk, encoding, callback) {
    let chunkOffset = 0;
setTimeout(() => {
      console.log(bufOffset);
    while (chunkOffset < chunk.length && bufOffset < buf.length) {
      const end = Math.min(buf.length - bufOffset, chunk.length - chunkOffset)
      const written = chunk.copy(buf, bufOffset, chunkOffset, end);
      chunkOffset += written;
      bufOffset += written;
    }
    if (bufOffset === buf.length) {
      //TODO: Write this.buf to some place
      console.log(bufOffset);
      bufOffset = 0;
    }
    callback();
}, 1000);
  }
});

/*
const writable = new Writable({
  write(chunk, encoding, callback) {
    console.log(chunk.length);
  },
});
*/

tee.pipe(writable);

setInterval(()=>{}, 1000);
